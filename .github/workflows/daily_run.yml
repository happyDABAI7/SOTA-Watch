name: SOTA Watch Daily Run

# 触发机制
on:
  # 1. 定时触发 (Cron 表达式)
  # UTC 时间 00:00 = 北京时间 08:00
  schedule:
    - cron: '0 0 * * *'
  
  # 2. 手动触发 (方便测试)
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest # 使用 GitHub 提供的免费 Linux 服务器

    steps:
    # 第一步：把代码拉取下来
    - name: Checkout code
      uses: actions/checkout@v3

    # 第二步：安装 Python 3.10
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    # 第三步：安装依赖库
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 第四步：运行主程序
    # 关键：这里要把 GitHub 仓库里的 Secrets 注入成环境变量
    - name: Run SOTA Watch Pipeline
      env:
        GH_TOKEN: ${{ secrets.GH_TOKEN }}
        HF_TOKEN: ${{ secrets.HF_TOKEN }}
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        FEISHU_WEBHOOK: ${{ secrets.FEISHU_WEBHOOK }}
      run: python main.py
